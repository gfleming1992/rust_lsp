# 8.2.3.5 StepRepeat

The StepRepeat elements provides information for steps representing panels or assembly pallets. Coupons may also use this feature to step the coupon description on the borders of the panel. The layer descriptions of any Board and Coupon combined in a Panel description must be of the same construction. The attribute stepRef is restricted in the XML schema to the unique name of the Step element referenced.  
If the features of a StepRepeat function become unique due to different characteristics such as one Step is at 90 degrees while the next Step is at 180 degrees two separate stepRepeat elements are required.  
 

## Attributes

| Attribute /  Element Name | Attribute /  Element Type | Description | Occurrence |
|---|---|---|---|
| StepRepeat | StepRepeatType | A nested element list containing the Step and Repeat functions that impact the information of the electronic product. | 0-n |
| stepRef | string | A reference to the step that should be replicated on the panel. | 1-1 |
| x | double | The X point of origin where the first step should be placed in relationship to the datum. This may be coincident or may be offset from the datum of the particular step. | 1-1 |
| y | double | The Y point of origin where the first step should be placed in relationship to the datum. This may be coincident or may be offset from the datum of the particular step. | 1-1 |
| nx | nonNegativeInteger | The total number of steps in the X direction, including the first step | 1-1 |
| ny | nonNegativeInteger | The total number of steps in the Y direction, including the first step | 1-1 |
| dx | nonNegativeDouble Type | The delta distance in the positive X direction from one step’s origin to the next, starting from the first step’s origin x, y (not necessarily the datum). | 1-1 |
| dy | nonNegativeDouble Type | The delta distance in the positive Y direction from one step’s origin to the next, starting from the first step’s origin x, y (not necessarily the datum). | 1-1 |
| angle | angleType | A unique angle to allow rotation of the StepRepeat image description where “0°” is as defined with the angle descriptions being counterclockwise (i.e., 45° 90°) from the horizontal zero angle. | 1-1 |
| mirror | boolean | An enumerated string is either “true” or “false” (part of the 3WC standard – must be lower case). True equals that the image is mirrored; False indicates that it is not. | 1-1 |
 

```xml
     <Step name = "KarensAssemblyPanel"> 
          <Datum x = "0.00" y = "0.00"/> 
               <Profile> 
                    <Polygon> 
                         <PolyBegin x = "0.00" y = "0.00"/> 
                         <PolyStepSegment x = "0.00" y = "427.00"/> 
                         <PolyStepSegment x = "260.00" y = "427.00"/> 
                         <PolyStepSegment x = "260.00" y = "0.00"/> 
                         <PolyStepSegment x = "0.00" y = "0.00"/> 
                    </Polygon> 
               </Profile> 
               <StepRepeat stepRef = "KarensSingleBoard" x = "110.00" y = "20.00" nx = "1" ny = "1" dx = "120.00" dy = "207.00" angle =  
                                     "90.00" mirror = “false”/> 
               <LayerFeature layerRef = "1-Top Signal"> 
                    <Set polarity = "POSITIVE"> 
                    <GlobalFiducial> 
                         <Location x = "250.00" y = "10.00"/> 
                         <Circle diameter = "1.00"/> 
                    </GlobalFiducial> 
                    <GlobalFiducial> 
                         <Location x = "250.00" y = "417.00"/> 
                         <Circle diameter = "1.00"/> 
                    </GlobalFiducial> 
                    <GlobalFiducial> 
                         <Location x = "10.00" y = "10.00"/> 
                         <Circle diameter = "1.00"/> 
                    </GlobalFiducial> 
                    <BadBoardMark> 
                         <Location x = "190.00" y = "5.00"/> 
                         <Circle diameter = "1.50"/> 
                    </BadBoardMark> 
                    <BadBoardMark> 
                         <Location x = "70.00" y = "5.00"/> 
                         <Circle diameter = "1.00"/> 
                    </BadBoardMark> 
                    <BadBoardMark> 
                         <Location x = "190.00" y = "213.00"/> 
                         <Circle diameter = "1.00"/> 
                    </BadBoardMark> 
                    <BadBoardMark> 
                         <Location x = "70.00" y = "213.00"/> 
                         <Circle diameter = "1.00"/> 
                    </BadBoardMark> 
                    <GoodPanelMark> 
                         <Location x = "250.00" y = "213.00"/> 
                         <Donut shape = "ROUND" outerDiameter = "1.50" innerDiameter = "0.80"/> 
                    </GoodPanelMark> 
               </Set> 
          </LayerFeature> 
     </Step> 
```

The following are examples of the step and repeat functions  
The following are 6 Panelization use cases that the IPC-2580 series must consider in its output. The number in the dark green area refers to a Design (in the last example, there are 4 unique Designs placed within a Panel).  


### 8.2.3.5.1 Single
A single Design is placed in a Panel.  
Figure 9 - Single Design within a Panel  
Requires one StepRepeat element that positions the design on the panel at the appropriate X-Y location.

```xml
<StepRepeat stepRef="SingleBoard" x="10.0" y="7.0" nx="1" ny="1" dx="0.0" dy="0.0" angle="0.00" mirror=“false” /> 
```

### 8.2.3.5.2 Single Array
One Design is placed in the same orientation throughout the panel. The size of the matrix is nx in the x direction, and ny in the y direction.  
Figure 10 - Design Array within a Panel  
Requires one StepRepeat element that references the design on the panel at the initial X-Y location.

```xml
<StepRepeat stepRef="SingleBoard" x="23" y="2.13" nx="2" ny="2" dx="152.5" dy="78.2" angle="0.00" mirror=“false” /> 
```

### 8.2.3.5.3 Double Array
A single design, but arrayed in two distinct row X column matrices. This panelization method is to use the maximum area of the PCB fabricator’s raw panel stock.  
Figure 11 - Design Array based on two  matrices within a Panel  
Requires two StepRepeat elements. The first StepRepeat element initially positions the design on the panel at the appropriate X-Y location. Then the design is stepped such that there is a total of two in the X direction and four in the Y direction. The second StepRepeat element orients the design on a 90° angle. This new orientation is then positioned on the panel at the appropriate X-Y location, and stepped such that there is a totgal of one in the X direction and two in the Y direction.

```xml
<StepRepeat stepRef=”board_1" x="60.0" y="12.0" nx="2" ny="4" dx="500" dy="100.00" angle="0.00" mirror=“false” /> 
<StepRepeat stepRef="board_1" x="950.00" y="12.0" nx="1" ny="2" dx="0" dy="190.0" angle="90.00" mirror=“false” /> 
```

### 8.2.3.5.4 Tiled
This example is to place a pair of single designs 180° out of phase with each other.  
Figure 12 - Design tiled as pairs within a Panel  
Requires two StepRepeat elements, where the first positions the design on the panel at the appropriate X-Y location, and then steps it such that there is a total of two in the X direction and two in the Y direction. The second StepRepeat element rotates the design 180°, and then positions the new orientation on the panel at the appropriate X-Y location. This reoriented design is then stepped such that again there is a total of two in the X direction and two in the Y direction. An appropriate initial X-Y location may be in the lower left portion of the panel with a positive X-Y step or in the upper right corner of the panel with a negative dx,dy step.

```xml
<StepRepeat stepRef=”board_1" x="30.0" y="20.0" nx="2" ny="2" dx="300.0" dy="100.0" angle="0.00" mirror=“false” /> 
<StepRepeat stepRef="board_1" x="1200.00" y="800.0" nx="2" ny="2" dx="-300.0" dy="-100.0" angle="180.00" mirror=“false” /> 
```

### 8.2.3.5.5 Flipped
“Flip” board pairing. This methodology is recent. The most important concern is that the board must be a symmetrical stackup, which means that the layer stackup must be verified to allow this type of panelization.  
Figure 13 - Design flipped as a pair within a Panel  
Requires two StepRepeat elements, the first positioning the design on the panel at the appropriate X-Y location, and then repeating such that there are a total of one in the X direction and 3 in the Y direction. The second StepRepeat element identifies the design as a mirror image, which is then positioned on the panel at the appropriate X-Y location, and repeated like the first.

```xml
<StepRepeat stepRef=”board_1" x="20.0" y="20.0" nx="1" ny="3" dx="0" dy="75.00" angle="0.00" mirror=“false” /> 
<StepRepeat stepRef=”board_1" x="250.0" y="20.0" nx="1" ny="3" dx="0" dy="75.00" angle="0.00" mirror=“true” /> 
```

### 8.2.3.5.6 Multiple Designs
The most important consideration with placing multiple designs (each number represents a unique design) within one panel is that all designs need to have been created within the same layer stackup.  The advantage is that an entire product can be assembled/tested all at once.  The disadvantage is that if one board of the panel has a problem (either with part availability or performance), this can lead to several additional scheduling/building/etc. problems as well.   
  
Figure 14 - Multiple Designs placed within a Panel  
The panel requires four StepRepeat elements. Design 1 is positioned on the panel at the appropriate X-Y location, and is then stepped such that there is a total of one in the X direction and three in the Y direction. Design 2 references a different Step and is positioned on the panel at the appropriate X-Y location. Design 3 references a different Step and is positioned on the panel at the appropriate X-Y location. For both Designs 2 and 3 the dx and dy attribute values are zero The fourth StepRepeat element identifies Design 4 as another different step, which is positioned on the panel at the appropriate X-Y location, and stepped such that there is a total of one in the X direction and two in the Y direction.

```xml
<StepRepeat stepRef="board_1" x="57.41629" y="12.30125" nx="1" ny="3" dx="0" dy="102.19426" angle="0.00" mirror=“false”/> <StepRepeat 
stepRef="board_2" x="260.56222" y="467.09018" nx="1" ny="1" dx="0" dy="0" angle="0.00" mirror=“false”/> 
<StepRepeat stepRef="board_3" x="260.56222" y="110.17554" nx="1" ny="1" dx="0" dy="0" angle="0.00" mirror=“false”/>  
<StepRepeat stepRef="board_4" x="927.85875" y="17.57629" nx="1" ny="2" dx="0" dy="138.0" angle="0.00" mirror=“false”/> 
```

See Appendix B for an example of an XML instance file.

### 8.2.3.5.7 Tooling Step and Repeat
The Step and repeat function can also be used to duplicate features that are to become part of the board, panel, or pallet. Figure 15 shows a series of slots that need to be included in a set of layers of the stackup. They may be replicated on each sheet that must be matched within the stackup.  
Figure 15 - Multiple Slots provided for tooling within a Panel  
Requires one StepRepeat element that positions the slot on the panel at the X-Y location that becomes the point of origin or Panel Datum. The Slot is stepped three times in the X direction and twice in the Y direction. The function  
   
may be accomplished as a step and repeat even if the features has a third dimension such as a depth of a cutout. The feature needs to be fully described as a single entity before it is repeated.

